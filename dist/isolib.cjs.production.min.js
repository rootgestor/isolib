"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(t),r=require("@ant-design/icons"),o=e(require("antd/lib/breadcrumb")),a=e(require("antd/lib/select")),i=e(require("lodash/debounce")),l=e(require("antd/lib/table")),c=e(require("antd/lib/button")),s=e(require("classnames")),u=require("reactflow"),d=e(u),f=e(require("antd/lib/modal"));function m(){return(m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function g(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t.indexOf(n=a[r])>=0||(o[n]=e[n]);return o}var p=["src","alt"];function b(e){var t=e.src,o=e.alt,a=g(e,p),i=r[t];return i?n.createElement(i,Object.assign({},a)):n.createElement("img",{style:m({padding:"5px"},a),src:t,alt:o})}var v=["fetchOptions","defaultOptions","defaultValue","onChange"];function h(e){var t="isolib-table-msg isolib-table-msg-icon";return e.important?n.createElement(r.BellFilled,{className:t+"--selected"}):n.createElement(r.BellOutlined,{className:t+"--no-selected"})}var E=["columns","dataSource","hidePagination","loading","onChange","onRowClick","pagination","isMessage"],y=function(e){var t=e.style;return n.createElement("div",{className:"isolib-text-collapse isolib-text-collapse-container",style:void 0===t?{}:t},e.children)},C=function(e){return n.createElement(c,{type:"link",className:"isolib-text-collapse-button",ref:e.innerRef,hidden:e.hidden,onClick:e.onClick,style:e.collapsed?{position:"absolute",right:"-"+e.space+"px"}:{}},e.children)},x=function(e){var t=e.collapsed,r=e.space,o=e.children;return n.createElement("div",{ref:e.innerRef,style:t&&r?{paddingRight:r}:{},className:s("isolib-text-collapse-internal",{"isolib-text-collapse-internal--collapsed":t})},o)},N=["icon","size","className"];function w(e){var t=e.icon,r=e.size,o=e.className,a=g(e,N);return"bigger"===r?n.createElement(w,Object.assign({className:"isolib__bigger-button "+o},a),n.createElement("div",{className:"isolib__bigger-button-label"},e.children),!!t&&n.createElement("div",{className:"isolib__bigger-button-icon"},n.createElement(b,{src:t}))):n.createElement(c,Object.assign({},e,{className:o,size:r}))}var _={__proto__:null,FlowNode:t.memo((function(e){var t=e.data,r=t.icon,o=t.label,a=t.onRemove,i=t.color,l=void 0===i?"#6938fb":i;return n.createElement(n.Fragment,null,n.createElement(u.Handle,{type:"target",position:u.Position.Top,isConnectable:!1}),n.createElement("div",{className:"react-flow__custom-node"},n.createElement("div",{className:"react-flow__custom-node-container",style:{borderColor:l}},n.createElement("div",{className:"react-flow__custom-node-header",style:{background:l}},n.createElement("span",{className:"react-flow__custom-node-header-icon"},n.createElement(b,{src:r})),!(null!=t&&t.static)&&n.createElement("span",{className:"react-flow__custom-node-header-close",onClick:a},n.createElement(b,{src:"CloseCircleFilled"}))),n.createElement("div",{className:"react-flow__custom-node-label"},o))),n.createElement(u.Handle,{type:"source",position:u.Position.Bottom,id:"b",style:{bottom:10,top:"auto"},isConnectable:!1}))}))},k={__proto__:null,FlowEdge:function(e){var t=e.id,r=e.sourceX,o=e.sourceY,a=e.targetX,i=e.targetY,l=e.style,c=void 0===l?{}:l,s=e.data,d=e.markerEnd,f=u.getBezierPath({sourceX:r,sourceY:o,sourcePosition:e.sourcePosition,targetX:a,targetY:i,targetPosition:e.targetPosition,curvature:0}),m=(r+a)/2,g=(o+i)/2,p=s.target,b=t;return n.createElement(n.Fragment,null,n.createElement("path",{id:t,style:c,className:"react-flow__edge-path",d:f[0],markerEnd:d}),!(null!=s&&s.static)&&n.createElement("g",{transform:"translate("+m+", "+g+")",onClick:function(){return null==s?void 0:s.onClick(p,b)}},n.createElement("rect",{x:"-10",y:"-10",width:"18",ry:"4",rx:"4",height:"18",fill:"white",stroke:"#b1b1b7"}),n.createElement("text",{fill:"#b1b1b7",y:"3",x:"-5"},"+")))}},S=function(e){return function(t){return e?e[t]:t}},O=function(e){var r=e.id,o=e.icon,a=e.label,i=e.modal,l=e.onSubmit,c=S(e.i18n),s=t.useState(!1),u=s[0],d=s[1],m=function(){return d(!1)};return n.createElement(n.Fragment,null,n.createElement(w,{key:r,icon:o,onClick:function(){i?d(!0):l({})},size:"bigger",className:"flow-modal-add-item"},a),!!i&&n.createElement(f,{title:c("Add node"),open:u,onCancel:m,footer:[n.createElement(w,{onClick:m},c("Close"))]},i({onSubmit:function(e){l(e),m()}})))},R=function(e){return e.filter((function(e){return"FlowNode"===e.type})).map((function(e){var t=e.data,n={label:t.label,icon:t.icon};return t.color&&(n.color=t.color),t.static&&(n.static=t.static),t.payload&&(n.payload=t.payload),n}))},j=function(e){return e.reduce((function(e,t,n){var r=e[n-1];return t.position.y=0===n?0:1===n?M:(null==r?void 0:r.position.y)+F,"start"!==(null==r?void 0:r.id)&&t.data.static&&(t.position.y-=P),[].concat(e,[t])}),[])},F=100,M=80,P=20,q={width:24,height:24,borderRadius:"50%",textTransform:"uppercase",textAlign:"center",padding:0,justifyContent:"center",alignItems:"center",display:"flex",fontSize:".3rem"},z=[{id:"start",type:"input",data:{label:"Start"},style:m({},q,{background:"#6938fb",borderColor:"#6938fb",color:"#fff"}),position:{x:63,y:0},draggable:!0},{id:"end",type:"output",style:m({},q,{background:"#6938fb",borderColor:"#6938fb",color:"#fff"}),data:{label:"End"},position:{x:63,y:M},draggable:!0}],A=[{id:"start-end",type:"FlowEdge",source:"start",target:"end"}];exports.Breadcrumb=function(e){var t=e.onClick;return n.createElement(o,{style:{margin:"16px 0"}},e.breadcrumbNameMap.map((function(e){var r,a=e.href;return n.createElement(o.Item,{key:a,href:"#",onClick:(r=a,function(e){return e.preventDefault(),r&&t(r),!1})},e.label)})))},exports.Button=w,exports.Flow=function(e){var r=t.useRef(null),o=S(e.i18n),a=t.useState(0),i=a[0],l=a[1],c=t.useState(!1),s=c[0],g=c[1],p=function(e){var n=e.defaultNodes,r=void 0===n?[]:n,o=e.onRemove,a=e.onAdd,i=e.openModal,l=e.draggable,c=t.useRef({idNode:"",idEdge:""}),s=u.useNodesState(z),d=s[0],f=s[1],g=s[2],p=u.useEdgesState(A),b=p[0],v=p[1],h=p[2],E=function(e,t){c.current={idNode:e,idEdge:t},i(!0)},y=function(e){var t=String(1e5*Math.random()),n=e.target;return{id:t,type:"FlowEdge",source:e.source,target:n,data:{target:n,static:e.static,onClick:E}}},C=function(e,t){var n=String(1e5*Math.random());return{id:n,type:"FlowNode",position:{x:0,y:0},draggable:l,data:m({},e,{payload:t,onRemove:function(){return e=n,t=[],f((function(n){return v((function(t){var r=n.findIndex((function(t){return t.id===e})),o=n[r+1],a=y({static:o.data.static,source:n[r-1].id,target:o.id}),i=t.filter((function(t){return t.source!==e&&t.target!==e}));return[].concat(i,[a])})),t=n.filter((function(t){return t.id!==e})),j(t)})),void(o&&o(R(t)));var e,t}})}};return t.useEffect((function(){var e=r.reduce((function(e,t,n){var r=e.nodes[n-1],o=C(t,t.payload||{}),a=y({static:t.static,source:r?r.id:"start",target:o.id});return m({},e,{nodes:[].concat(e.nodes,[o]),edges:[].concat(e.edges,[a])})}),{nodes:[],edges:[]}),t=z.map((function(e){return m({},e,{draggable:l})})),n=j([t[0]].concat(e.nodes,[t[1]])),o=y({source:n[n.length-2].id,target:"end"});f(n),v([].concat(e.edges,[o]))}),[]),{nodes:d,edges:b,onNodesChange:g,onEdgesChange:h,handleAdd:function(e){return function(t){var n=[],r=c.current,o=r.idNode,l=r.idEdge,s=C(e,t);f((function(e){v((function(e){var t=e.find((function(e){return e.id===l}));if(!t)return e;var n=e.filter((function(e){return e.id!==l})),r=[y({source:t.source,target:s.id}),y({source:s.id,target:t.target})];return n.concat(r)}));var t=(n=[].concat(e)).findIndex((function(e){return e.id===o}));return n.splice(t,0,s),j(n)})),a&&a(R(n)),i(!1)}}}}({defaultNodes:e.defaultNodes,onRemove:e.onRemove,onAdd:e.onAdd,openModal:g,draggable:e.draggable}),b=function(){return g(!1)};return t.useEffect((function(){var e,t=null==(e=r.current)?void 0:e.offsetWidth;t&&l(t/2-150)}),[]),n.createElement("div",{ref:r,className:"react-flow-global-container",style:{width:"100%",height:"100vh"}},i&&n.createElement(n.Fragment,null,n.createElement(d,Object.assign({},p,{edgeTypes:k,nodeTypes:_,snapToGrid:!0,defaultViewport:{x:i,y:0,zoom:2},minZoom:1,maxZoom:2,attributionPosition:"bottom-left"}),n.createElement(u.Controls,{showInteractive:!1})),e.nodeTypes&&n.createElement(f,{title:o("Add node"),open:s,onCancel:b,footer:[n.createElement(w,{onClick:b},o("Close"))]},n.createElement("div",{className:"flow-modal-add-container"},e.nodeTypes.map((function(t){return n.createElement(O,Object.assign({key:t.id},t,{onSubmit:p.handleAdd(t),i18n:e.i18n}))}))))))},exports.Icon=b,exports.SelectAsync=function(e){var r=e.fetchOptions,o=e.defaultOptions,l=e.defaultValue,c=e.onChange,s=g(e,v),u=t.useState((function(){return l})),d=u[0],f=u[1],m=t.useState((function(){return o})),p=m[0],b=m[1],h=t.useState(!1),E=h[0],y=h[1],C=t.useRef(0),x=t.useMemo((function(){return i((function(e){C.current+=1;var t=C.current;y(!0),r(e).then((function(e){t===C.current&&(y(!1),b(e))}))}),800)}),[r]);return n.createElement(a,Object.assign({labelInValue:!0,filterOption:!1,onSearch:x,onFocus:x},s,{loading:E,value:d,onChange:function(e,t){f(e),c&&c(e,t)},options:p}))},exports.Table=function(e){var r=e.columns,o=e.dataSource,a=e.hidePagination,i=void 0!==a&&a,c=e.loading,s=void 0===c||c,u=e.onChange,d=e.onRowClick,f=e.pagination,p=e.isMessage,b=void 0!==p&&p,v=g(e,E),y=t.useState(""),C=y[0],x=y[1],N=[];b&&N.push({dataIndex:"important",key:"important",width:40,render:function(e,t){return n.createElement(h,Object.assign({},t))}});var w,_=function(e){return function(){d&&d(e)}};return n.createElement("div",{className:"isolib-table "+(b?"isolib-table-msg":"")},n.createElement(l,Object.assign({size:"middle",scroll:{y:"100%"}},v,{rowSelection:{type:"checkbox"},columns:[].concat(N,r),dataSource:o,pagination:!i&&m({},f,{showSizeChanger:!0,position:["bottomCenter"]}),onChange:u,loading:s,rowKey:function(e){return e._id},rowClassName:b?(w=C,function(e){var t=["isolib-table-msg"];return!1===e.read&&t.push("isolib-table-msg--unread"),w===e._id&&t.push("isolib-table-msg--hover"),t.join(" ")}):"",onRow:function(e){return{onClick:_(e),onMouseEnter:function(){return x(e._id)},onMouseLeave:function(){return x("")}}}})))},exports.TextCollapse=function(e){var r=e.children,o=e.textSpace,a=e.textLess,i=e.textMore,l=e.style,c=void 0===l?{}:l,s=t.useState(!0),u=s[0],d=s[1],f=t.useState(!0),m=f[0],g=f[1],p=t.useRef(null),b=t.useRef(null),v=t.useRef(null);return t.useEffect((function(){b.current&&v.current&&g(!!(v.current.offsetWidth+o<b.current.offsetWidth))}),[o]),n.createElement(y,{style:c},n.createElement(x,{collapsed:u,innerRef:b,space:o},n.createElement("span",{ref:v},r),n.createElement(C,{innerRef:p,collapsed:u,onClick:function(){d(!u)},hidden:m,space:o},u?i:a)))};
//# sourceMappingURL=isolib.cjs.production.min.js.map
