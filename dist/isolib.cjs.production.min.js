"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(t),r=require("@ant-design/icons"),o=e(require("antd/lib/breadcrumb")),a=e(require("antd/lib/select")),i=e(require("lodash/debounce")),l=e(require("antd/lib/table")),c=e(require("antd/lib/button")),s=e(require("classnames")),u=require("reactflow"),d=e(u),f=e(require("antd/lib/modal"));function m(){return(m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function g(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t.indexOf(n=a[r])>=0||(o[n]=e[n]);return o}var b=["src"];function p(e){var t=e.src,o=g(e,b),a=r[t];return a?n.createElement(a,Object.assign({},o)):n.createElement("img",{style:m({padding:"5px"},o),src:t})}var v=["fetchOptions","defaultOptions","defaultValue","onChange"];function h(e){var t="isolib-table-msg isolib-table-msg-icon";return e.important?n.createElement(r.BellFilled,{className:t+"--selected"}):n.createElement(r.BellOutlined,{className:t+"--no-selected"})}var E=["columns","dataSource","hidePagination","loading","onChange","onRowClick","pagination","isMessage"],y=function(e){var t=e.style;return n.createElement("div",{className:"isolib-text-collapse isolib-text-collapse-container",style:void 0===t?{}:t},e.children)},C=function(e){return n.createElement(c,{type:"link",className:"isolib-text-collapse-button",ref:e.innerRef,hidden:e.hidden,onClick:e.onClick,style:e.collapsed?{position:"absolute",right:"-"+e.space+"px"}:{}},e.children)},x=function(e){var t=e.collapsed,r=e.space,o=e.children;return n.createElement("div",{ref:e.innerRef,style:t&&r?{paddingRight:r}:{},className:s("isolib-text-collapse-internal",{"isolib-text-collapse-internal--collapsed":t})},o)},w=["icon","size","className"];function N(e){var t=e.icon,r=e.size,o=e.className,a=g(e,w);return"bigger"===r?n.createElement(N,Object.assign({className:"isolib__bigger-button "+o},a),n.createElement("div",{className:"isolib__bigger-button-label"},e.children),!!t&&n.createElement("div",{className:"isolib__bigger-button-icon"},n.createElement(p,{src:t}))):n.createElement(c,Object.assign({},e,{className:o,size:r}))}var _={__proto__:null,FlowNode:t.memo((function(e){var t=e.data,r=t.icon,o=t.label,a=t.onRemove,i=t.color,l=void 0===i?"#6938fb":i;return n.createElement(n.Fragment,null,n.createElement(u.Handle,{type:"target",position:u.Position.Top}),n.createElement("div",{className:"react-flow__custom-node"},n.createElement("div",{className:"react-flow__custom-node-container",style:{borderColor:l}},n.createElement("div",{className:"react-flow__custom-node-header",style:{background:l}},n.createElement("span",{className:"react-flow__custom-node-header-icon"},n.createElement(p,{src:r})),!(null!=t&&t.static)&&n.createElement("span",{className:"react-flow__custom-node-header-close",onClick:a},n.createElement(p,{src:"CloseCircleFilled"}))),n.createElement("div",{className:"react-flow__custom-node-label"},o))),n.createElement(u.Handle,{type:"source",position:u.Position.Bottom,id:"b",style:{bottom:10,top:"auto"}}))}))},k={__proto__:null,FlowEdge:function(e){var t=e.id,r=e.sourceX,o=e.sourceY,a=e.targetX,i=e.targetY,l=e.style,c=void 0===l?{}:l,s=e.data,d=e.markerEnd,f=u.getBezierPath({sourceX:r,sourceY:o,sourcePosition:e.sourcePosition,targetX:a,targetY:i,targetPosition:e.targetPosition,curvature:0}),m=(r+a)/2,g=(o+i)/2,b=s.target,p=t;return n.createElement(n.Fragment,null,n.createElement("path",{id:t,style:c,className:"react-flow__edge-path",d:f[0],markerEnd:d}),!(null!=s&&s.static)&&n.createElement(n.Fragment,null,n.createElement("g",{transform:"translate("+m+", "+g+")",onClick:function(){return null==s?void 0:s.onAdd(b,p)}},n.createElement("rect",{x:"-10",y:"-20",width:"18",ry:"4",rx:"4",height:"18",fill:"white",stroke:"#b1b1b7"}),n.createElement("text",{fill:"#b1b1b7",y:"-7",x:"-5"},"+")),n.createElement("g",{transform:"translate("+m+", "+g+")",onClick:function(){return null==s?void 0:s.onRemove(p)}},n.createElement("rect",{x:"-10",y:"2",width:"18",ry:"4",rx:"4",height:"18",fill:"white",stroke:"#b1b1b7"}),n.createElement("text",{fill:"#b1b1b7",y:"15",x:"-4"},"-"))))}},S=function(e){return function(t){return e?e[t]:t}},O=function(e){var r=e.id,o=e.icon,a=e.label,i=e.form,l=e.onSubmit,c=S(e.i18n),s=t.useState(!1),u=s[0],d=s[1],m=function(){return d(!1)};return n.createElement(n.Fragment,null,n.createElement(N,{key:r,icon:o,onClick:function(){return d(!0)},size:"bigger",className:"flow-modal-add-item"},a),n.createElement(f,{title:c("Add node"),open:u,onCancel:m,footer:[n.createElement(N,{onClick:m},c("Close"))]},i({onSubmit:function(e){l(e),m()}})))},R=function(e,t){return e.filter((function(e){return"FlowNode"===e.type})).map((function(e){var n,r,o=e.data,a=e.id,i=null==(n=t.find((function(e){return e.source===a})))?void 0:n.id,l=null==(r=t.find((function(e){return e.target===a})))?void 0:r.id,c={label:o.label,icon:o.icon};return i&&l||(c.unrelated=!0),o.color&&(c.color=o.color),o.static&&(c.static=o.static),o.payload&&(c.payload=o.payload),c}))},j=function(e){return e.reduce((function(e,t,n){var r=e[n-1];return t.position.y=0===n?0:1===n?M:(null==r?void 0:r.position.y)+F,"start"!==(null==r?void 0:r.id)&&t.data.static&&(t.position.y-=P),[].concat(e,[t])}),[])},F=100,M=80,P=20,q={width:24,height:24,borderRadius:"50%",textTransform:"uppercase",textAlign:"center",padding:0,justifyContent:"center",alignItems:"center",display:"flex",fontSize:".3rem"},z=[{id:"start",type:"input",data:{label:"Start"},style:m({},q,{background:"#6938fb",borderColor:"#6938fb",color:"#fff"}),position:{x:63,y:0},draggable:!0},{id:"end",type:"output",style:m({},q,{background:"#6938fb",borderColor:"#6938fb",color:"#fff"}),data:{label:"End"},position:{x:63,y:M},draggable:!0}],T=[{id:"start-end",type:"FlowEdge",source:"start",target:"end"}];exports.Breadcrumb=function(e){var t=e.onClick;return n.createElement(o,{style:{margin:"16px 0"}},e.breadcrumbNameMap.map((function(e){var r,a=e.href;return n.createElement(o.Item,{key:a,href:"#",onClick:(r=a,function(e){return e.preventDefault(),r&&t(r),!1})},e.label)})))},exports.Button=N,exports.Flow=function(e){var r=t.useRef(null),o=S(e.i18n),a=t.useState(0),i=a[0],l=a[1],c=t.useState(!1),s=c[0],g=c[1],b=function(e){var n=e.defaultNodes,r=void 0===n?[]:n,o=e.onChange,a=e.openModal,i=e.draggable,l=t.useRef({idNode:"",idEdge:""}),c=u.useNodesState(z),s=c[0],d=c[1],f=c[2],g=u.useEdgesState(T),b=g[0],p=g[1],v=g[2],h=function(e,t){l.current={idNode:e,idEdge:t},a(!0)},E=function(e){var t=[],n=[];d((function(e){return t=[].concat(e),e})),p((function(t){return n=t.filter((function(t){return t.id!==e}))})),o&&o(R(t,n))},y=t.useCallback((function(e){var t=[],n=[];d((function(e){return t=[].concat(e),e})),p((function(t){var r=t.filter((function(t){return t.target===e.target||t.source===e.target})),o=t.filter((function(t){return t.target===e.source||t.source===e.source}));return r.length>1||o.length>1?t:n=u.addEdge(C(e),t)})),o&&o(R(t,n))}),[]),C=function(e){var t=String(1e5*Math.random()),n=e.target;return{id:t,type:"FlowEdge",source:e.source,target:n,data:{target:n,static:e.static,onAdd:h,onRemove:E}}},x=function(e,t){var n=String(1e5*Math.random());return{id:n,type:"FlowNode",position:{x:0,y:0},draggable:i,data:m({},e,{payload:t,onRemove:function(){return e=n,t=[],r=[],d((function(n){return p((function(t){var o=n.findIndex((function(t){return t.id===e})),a=n[o+1],i=C({static:a.data.static,source:n[o-1].id,target:a.id}),l=t.filter((function(t){return t.source!==e&&t.target!==e}));return r=[].concat(l,[i])})),t=n.filter((function(t){return t.id!==e})),j(t)})),void(o&&o(R(t,r)));var e,t,r}})}};return t.useEffect((function(){var e=r.reduce((function(e,t,n){var r=e.nodes[n-1],o=x(t,t.payload||{}),a=C({static:t.static,source:r?r.id:"start",target:o.id});return m({},e,{nodes:[].concat(e.nodes,[o]),edges:[].concat(e.edges,[a])})}),{nodes:[],edges:[]}),t=z.map((function(e){return m({},e,{draggable:i})})),n=j([t[0]].concat(e.nodes,[t[1]])),o=C({source:n[n.length-2].id,target:"end"});d(n),p([].concat(e.edges,[o]))}),[]),{nodes:s,edges:b,onNodesChange:f,onEdgesChange:v,handleAdd:function(e){return function(t){var n=[],r=[],i=l.current,c=i.idNode,s=i.idEdge,u=x(e,t);d((function(e){p((function(e){var t=e.find((function(e){return e.id===s}));if(!t)return e;var n=[C({source:t.source,target:u.id}),C({source:u.id,target:t.target})];return r=e.filter((function(e){return e.id!==s})).concat(n)}));var t=(n=[].concat(e)).findIndex((function(e){return e.id===c}));return n.splice(t,0,u),j(n)})),o&&o(R(n,r)),a(!1)}},onConnect:y}}({defaultNodes:e.defaultNodes,onChange:e.onChange,openModal:g,draggable:e.draggable}),p=function(){return g(!1)};return t.useEffect((function(){var e,t=null==(e=r.current)?void 0:e.offsetWidth;t&&l(t/2-150)}),[]),n.createElement("div",{ref:r,className:"react-flow-global-container",style:{width:"100%",height:"100vh"}},i&&n.createElement(n.Fragment,null,n.createElement(d,Object.assign({},b,{edgeTypes:k,nodeTypes:_,snapToGrid:!0,defaultViewport:{x:i,y:0,zoom:2},minZoom:1,maxZoom:2,attributionPosition:"bottom-left"}),n.createElement(u.Controls,{showInteractive:!1})),e.nodeTypes&&n.createElement(f,{title:o("Add node"),open:s,onCancel:p,footer:[n.createElement(N,{onClick:p},o("Close"))]},n.createElement("div",{className:"flow-modal-add-container"},e.nodeTypes.map((function(t){return n.createElement(O,Object.assign({key:t.id},t,{onSubmit:b.handleAdd(t),i18n:e.i18n}))}))))))},exports.Icon=p,exports.SelectAsync=function(e){var r=e.fetchOptions,o=e.defaultOptions,l=e.defaultValue,c=e.onChange,s=g(e,v),u=t.useState((function(){return l})),d=u[0],f=u[1],m=t.useState((function(){return o})),b=m[0],p=m[1],h=t.useState(!1),E=h[0],y=h[1],C=t.useRef(0),x=t.useMemo((function(){return i((function(e){C.current+=1;var t=C.current;y(!0),r(e).then((function(e){t===C.current&&(y(!1),p(e))}))}),800)}),[r]);return n.createElement(a,Object.assign({labelInValue:!0,filterOption:!1,onSearch:x,onFocus:x},s,{loading:E,value:d,onChange:function(e,t){f(e),c&&c(e,t)},options:b}))},exports.Table=function(e){var r=e.columns,o=e.dataSource,a=e.hidePagination,i=void 0!==a&&a,c=e.loading,s=void 0===c||c,u=e.onChange,d=e.onRowClick,f=e.pagination,b=e.isMessage,p=void 0!==b&&b,v=g(e,E),y=t.useState(""),C=y[0],x=y[1],w=[];p&&w.push({dataIndex:"important",key:"important",width:40,render:function(e,t){return n.createElement(h,Object.assign({},t))}});var N,_=function(e){return function(){d&&d(e)}};return n.createElement("div",{className:"isolib-table "+(p?"isolib-table-msg":"")},n.createElement(l,Object.assign({size:"middle",scroll:{y:"100%"}},v,{rowSelection:{type:"checkbox"},columns:[].concat(w,r),dataSource:o,pagination:!i&&m({},f,{showSizeChanger:!0,position:["bottomCenter"]}),onChange:u,loading:s,rowKey:function(e){return e._id},rowClassName:p?(N=C,function(e){var t=["isolib-table-msg"];return!1===e.read&&t.push("isolib-table-msg--unread"),N===e._id&&t.push("isolib-table-msg--hover"),t.join(" ")}):"",onRow:function(e){return{onClick:_(e),onMouseEnter:function(){return x(e._id)},onMouseLeave:function(){return x("")}}}})))},exports.TextCollapse=function(e){var r=e.children,o=e.textSpace,a=e.textLess,i=e.textMore,l=e.style,c=void 0===l?{}:l,s=t.useState(!0),u=s[0],d=s[1],f=t.useState(!0),m=f[0],g=f[1],b=t.useRef(null),p=t.useRef(null),v=t.useRef(null);return t.useEffect((function(){p.current&&v.current&&g(!!(v.current.offsetWidth+o<p.current.offsetWidth))}),[o]),n.createElement(y,{style:c},n.createElement(x,{collapsed:u,innerRef:p,space:o},n.createElement("span",{ref:v},r),n.createElement(C,{innerRef:b,collapsed:u,onClick:function(){d(!u)},hidden:m,space:o},u?i:a)))};
//# sourceMappingURL=isolib.cjs.production.min.js.map
